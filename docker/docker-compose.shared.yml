# Shared infrastructure for all stacks (main + agent)
# Start with: docker compose -f docker-compose.shared.yml up -d
#
# This runs MongoDB and docs as shared services on the jwst-shared network.
# All agent stacks and the main stack connect to this network.

name: jwst-shared

services:
  mongodb:
    image: mongo:8.0
    container_name: jwst-mongodb
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME:?Set MONGO_ROOT_USERNAME in .env (see .env.example)}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD:?Set MONGO_ROOT_PASSWORD in .env (see .env.example)}
    volumes:
      - jwst-mongodb-data:/data/db
    ports:
      - "127.0.0.1:27017:27017"
    networks:
      - jwst-shared

  docs:
    image: squidfunk/mkdocs-material:9
    container_name: jwst-docs
    restart: unless-stopped
    ports:
      - "127.0.0.1:8001:8000"
    volumes:
      - ../mkdocs.yml:/app/mkdocs.yml
      - ../docs:/app/docs
    working_dir: /app
    command: [ "serve", "--dev-addr=0.0.0.0:8000" ]
    networks:
      - jwst-shared

volumes:
  jwst-mongodb-data:
    name: jwst-mongodb-data

networks:
  jwst-shared:
    driver: bridge
    name: jwst-shared
