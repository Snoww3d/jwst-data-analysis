# Agent worktree Docker Compose overlay
# Usage: docker compose -p jwst-agent1 -f docker-compose.yml -f docker-compose.agent.yml up -d
#
# Each agent worktree uses its own .env with unique ports and container names.
# This overlay parameterizes ports and disables hardcoded container_name so
# Docker Compose project isolation works correctly.

services:
  mongodb:
    container_name: ${COMPOSE_CONTAINER_PREFIX:-jwst}-mongodb
    ports:
      - "${MONGO_PORT:-27017}:27017"

  backend:
    container_name: ${COMPOSE_CONTAINER_PREFIX:-jwst}-backend
    ports:
      - "${BACKEND_PORT:-5001}:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - CORS_ALLOWED_ORIGINS=http://localhost:${FRONTEND_PORT:-3000},http://localhost:${VITE_DEV_PORT:-5173}
    volumes:
      - ${DATA_DIR:-../data}:/app/data

  processing-engine:
    container_name: ${COMPOSE_CONTAINER_PREFIX:-jwst}-processing
    ports:
      - "${PROCESSING_PORT:-8000}:8000"
    volumes:
      - ${DATA_DIR:-../data}:/app/data

  frontend:
    build:
      context: ../frontend/jwst-frontend
      dockerfile: Dockerfile.dev
    container_name: ${COMPOSE_CONTAINER_PREFIX:-jwst}-frontend
    restart: unless-stopped
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
    volumes:
      - ../frontend/jwst-frontend:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:${BACKEND_PORT:-5001}
    depends_on:
      - backend
    networks:
      - jwst-network

  docs:
    container_name: ${COMPOSE_CONTAINER_PREFIX:-jwst}-docs
    ports:
      - "${DOCS_PORT:-8001}:8000"
